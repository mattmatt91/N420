{% extends 'index.html' %}






{% block content %}


<div class="panel panel-success">
    <div class="panel-heading">DATA</div>
    <div class="panel-body">
        <div class="panel panel-success">
            <div class="panel-heading">OPTIONS</div>
            <div class="panel-body">
                <form id="formFan">
                    <div class="row">
                        <div class="col">
                            <input class="form-check-input" type="checkbox" name="temp" id="cbTemp" >
                            <label class="form-check-label" for="cbTemp">TEMP.</label>
                        </div>
                        <div class="col">
                            <input class="form-check-input" type="checkbox" name="pres" id="cbpres">
                            <label class="form-check-label" for="cbpres">PRES.</label>
                        </div>
                        <div class="col">
                            <input class="form-check-input" type="checkbox" name="soil1" id="cbSoil1">
                            <label class="form-check-label" for="cbSoil1">SOIL. 1</label>
                        </div>
                        <div class="col">
                            <input class="form-check-input" type="checkbox" name="soil2" id="cbSoil2">
                            <label class="form-check-label" for="cbSoil2">SOIL. 2</label>
                        </div>
                        <div class="col">
                            <input class="form-check-input" type="checkbox" name="fan_state" id="cbFan">
                            <label class="form-check-label" for="cbFan">FAN</label>
                        </div>
                        <div class="col">
                            <input class="form-check-input" type="checkbox" name="lamp_state" id="cbLamp">
                            <label class="form-check-label" for="cbLamp">LAMP</label>
                        </div>
                    </div>
                    <p></p>
                    <div class="row">
                        <label class="range-label" for="days">DAYS: <output class="range_label"
                                id="labelDays">10</output></label>
                    </div>
                    <div class="row">
                        <input type="range" id="days" name="days" min="1" max="28" value="10"
                            oninput="update_value_label('#labelDays', this.value)" />
                    </div>

                    <div class="row">
                        </p>
                        <input type="submit" value="LOAD" class="btn btn-success" id="submitOptions" />
                    </div>
                </form>
            </div>
        </div>



        <canvas id="myChart" style="width:100%;max-width:600px"></canvas>


    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
<script type="text/javascript">


    $(document).ready(function () {
        $('form').on('submit', function (event) {
            event.preventDefault();

            // It returns a array of object 
            let userinfo = $(this).serializeArray();
            //console.log(userinfo)
            let user = {};
            userinfo.forEach((value) => {

                // Dynamically create an object
                user[value.name] = value.value;
            });
            let url = "/plots/options";
            $.ajax({
                method: "POST",
                url: url,
                data: user,
                success: function (response) {
                    console.log(response)
                    let myData = response;
                    var colors = {
                        'temp': 'red',
                        'pres': 'green',
                        'soil1': 'orange',
                        'soil2': 'yellow',
                        'fan_state': 'blue',
                        'lamp_state': 'lime'
                    }
                    var keys = Object.keys(myData)
                    //console.log(keys)
                    var xValues = Object.values(myData['date']);
                    delete myData["date"];
                    var secs = 30;
                    let my_datasets = [];
                    var xValues_date = []
                    for (var i in xValues) {

 
                        xValues_date.push(new Date(i).toLocaleString('en-GB',{timeZone:'UTC'}));
                    }
                    console.log(xValues_date);


                    for (const key in myData) {
                        let dataset = {
                            data: Object.values(myData[key]),
                            borderColor: colors[key],
                            fill: false
                        };

                        my_datasets.push(dataset)
                    }

                    console.log(my_datasets);
                    new Chart("myChart", {
                        type: "line",
                        data: {
                            labels: xValues_date,
                            datasets: my_datasets
                        },
                        options: {
                            legend: { display: true }
                        }
                    });

                },
                dataType: "json"
            })
        });
    });





    //updata range label
    function update_value_label(label, value) {
        document.querySelector(label).value = value;
    }

    //plot


</script>
{% endblock %}